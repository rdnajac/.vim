#!/bin/bash
#
## Add git submodules to the repository

set -euo pipefail
set -x

die() {
	printf "\e[31m%s\e[0m\n" "$*"
	exit 1
}

add_submodule() {
	local url="$1"
	[[ "$url" =~ ^https://github.com ]] \
		&& github_url="${url%%\?*}" \
		|| github_url="https://github.com/${url}.git"
	# TODO

	PLUGIN_DIR="${HOME}/.vim/pack/vimfect/opt"
	mkdir -p "$PLUGIN_DIR"
	cd "$PLUGIN_DIR" || die "Failed to change directory to $PLUGIN_DIR"

	git submodule add --force --depth 1 --progress "$github_url"
}

# Check if the user has provided at least one  url
[[ $# -gt 0 ]] || die "Usage: $0 <url>..."

while [[ $# -gt 0 ]]; do
	add_submodule "$1"
	shift
done
