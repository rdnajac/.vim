#!/bin/sh
#
# vimfect: vim plugin management using git submodules.

set -eux
PACKPATH="${HOME}/.vim/pack/plugin/"
SCRIPT_DIR=$(cd "$(dirname "$0")" && pwd)
# make sure theyr ethe same

resolve_repo_url() {
  local repo=$1
  if ! echo "$repo" | grep -q '^https://\|^git@'; then
    repo="https://github.com/$repo.git"
  fi
  echo "$repo"
  # use printf
}

add_submodule() {
  local repo
  repo=$(resolve_repo_url "$1")

  git submodule add "$repo" &&
  git commit -m "vimfect: added $repo" &&
}

sync_submodules() {
  git submodule sync
  git submodule update --init --recursive
}

main() {
  if [ $# -eq 0 ]; then
    bail "Usage: ${SCRIPT_NAME} <repository>..."
  fi

  cd "$SCRIPT_DIR"

  for repo in "$@"; do
    add_submodule "$repo"
  done

  sync_submodules
}

main "$@"

